(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c0a47"],{"433e":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("div",{staticClass:"filter-container"},[n("el-row",[n("el-col",{attrs:{span:16}},[n("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.formInline,size:"mini"}},[n("el-form-item",{attrs:{label:"评价主题:"}},[e._v(" "+e._s(e.currentIndicator.field)+" ")]),n("el-form-item",{attrs:{label:"评价对象:"}},[e._v(" "+e._s(e.currentIndicator.scope)+" ")]),"BD"===e.formInline.scope?n("el-form-item",{attrs:{label:""}},[n("el-input",{attrs:{placeholder:"请输入评价对象"},model:{value:e.formInline.army,callback:function(t){e.$set(e.formInline,"army",t)},expression:"formInline.army"}})],1):e._e()],1)],1)],1)],1),n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{height:"1000px"},attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[n("el-row",{staticClass:"tree"},[n("el-col",{staticClass:"tree-container",attrs:{span:16}},[n("el-row",[n("el-col",{attrs:{span:24}},[n("el-button",{staticClass:"noimpor-btn",attrs:{type:"primary",size:"mini"},on:{click:e.addNode}},[n("i",{staticClass:"el-icon-plus"}),e._v(" 添加节点")]),n("el-button",{staticClass:"noimpor-btn",attrs:{type:"primary",size:"mini"},on:{click:e.onRemoveNode}},[n("i",{staticClass:"el-icon-minus"}),e._v(" 删除节点")])],1)],1),n("div",{staticClass:"treeMind"},[n("TreeMindComponent",{ref:"jsMind",attrs:{values:e.mind,options:e.options,height:e.mindHeight},on:{selectNodeChange:e.selectNodeChange,saveTempMind:e.saveTempMind}})],1),n("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"center"}},[n("el-button",{staticClass:"noimpor-btn",attrs:{type:"primary",size:"mini"},on:{click:e.saveMind}},[e._v(" 确认更改")]),n("el-button",{staticClass:"common-btn",attrs:{type:"primary",size:"mini",disabled:e.cancel_btn_disabled},on:{click:e.cancel}},[e._v(" 取消")])],1)],1),n("el-col",{staticClass:"tree-container tree-container-text",attrs:{span:8}},[n("TreeDetailEditComponent")],1)],1)],1)])},a=[],r=n("5530"),o=(n("159b"),n("b0c0"),n("2f62")),s=n("9139"),c=n("5f2c"),d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-container",[n("el-main",[n("el-form",{ref:"dataForm",staticStyle:{width:"90%","margin-left":"10px","margin-top":"20px"},attrs:{rules:e.rules,model:e.currentNode,size:"small","label-position":"right","label-width":"90px"}},[n("el-form-item",{attrs:{label:"指标名称",prop:"indicator_name"}},[n("el-input",{model:{value:e.currentNode.indicator_name,callback:function(t){e.$set(e.currentNode,"indicator_name",t)},expression:"currentNode.indicator_name"}})],1),n("el-form-item",{directives:[{name:"show",rawName:"v-show",value:3===e.currentNode.level,expression:"currentNode.level===3"}],attrs:{label:"指标单位",prop:"indicator_unit"}},[n("el-input",{model:{value:e.currentNode.indicator_unit,callback:function(t){e.$set(e.currentNode,"indicator_unit",t)},expression:"currentNode.indicator_unit"}})],1),n("el-form-item",{directives:[{name:"show",rawName:"v-show",value:3===e.currentNode.level,expression:"currentNode.level===3"}],attrs:{label:"单位符号",prop:"indicator_sign"}},[n("el-input",{model:{value:e.currentNode.indicator_sign,callback:function(t){e.$set(e.currentNode,"indicator_sign",t)},expression:"currentNode.indicator_sign"}})],1),n("el-form-item",{attrs:{label:"指标简介",prop:"profile"}},[n("el-input",{attrs:{autosize:{minRows:2},type:"textarea",placeholder:"请输入指标简介"},model:{value:e.currentNode.profile,callback:function(t){e.$set(e.currentNode,"profile",t)},expression:"currentNode.profile"}})],1),n("el-form-item",{attrs:{label:"指标详情"}},[n("el-input",{attrs:{autosize:{minRows:2},type:"textarea",placeholder:"请输入指标详情"},model:{value:e.currentNode.summary,callback:function(t){e.$set(e.currentNode,"summary",t)},expression:"currentNode.summary"}})],1),n("el-form-item",{attrs:{label:"指标权重"}},[n("el-input",{attrs:{placeholder:"请填写权重值",type:"number"},model:{value:e.currentNode.weight,callback:function(t){e.$set(e.currentNode,"weight",t)},expression:"currentNode.weight"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.tempSave}},[e._v("暂存数据")])],1)],1)],1)],1)},l=[],m=n("ed08"),u={data:function(){return{parentID:"",rootParentID:"",rules:{indicator_name:[{required:!0,message:"指标名称为必填项",trigger:"blur"}]}}},computed:Object(r["a"])({},Object(o["b"])(["currentNode"])),methods:{tempSave:function(){var e=this,t=window._jm.get_selected_node();if(t){var n=new Date;t.data.weight=this.currentNode.weight,t.data.profile=this.currentNode.profile,t.data.summary=this.currentNode.summary,t.data.indicator_name=this.currentNode.indicator_name,t.data.updateTime=Object(m["b"])(n,"{y}-{m}-{d} {h}:{i}"),t.data.update_by="admin";var i=t.id;window._jm.update_node(i,this.currentNode.indicator_name)}var a=[window._jm.get_data().data];this.parentID=a[0].indicator_id,this.rootParentID=a[0].indicator_id,console.log(a);var r=a;Object(s["e"])(r).then((function(t){e.$message({type:"success",message:"暂存指标成功!"})})).catch((function(t){e.$message({type:"error",message:"暂存指标失败，请稍后重试!"}),console.log(t)})),window._jm.select_clear()}}},p=u,h=n("2877"),_=Object(h["a"])(p,d,l,!1,null,null,null),g=_.exports,f={components:{TreeDetailEditComponent:g,TreeMindComponent:c["a"]},data:function(){return{loading:!1,dialogTableVisible:!1,cancel_json:"",cancel_btn_disabled:!0,mind:{meta:{name:"",author:"",version:""},format:"node_tree",data:{id:"root",name:""}},mindHeight:"100%",options:{container:"jsmind_container",editable:!0,theme:"orange",shortcut:{enable:!1}},tempLevel:0,formInline:{area:"",scope:"",army:""}}},computed:Object(r["a"])({},Object(o["b"])(["scope","field","currentIndicator","currentNode"])),mounted:function(){this.jm=this.$refs.jsMind.jm,window._jm=this.jm,this.getData(),console.log(this.$router)},methods:{handleFilter:function(){console.log("handleFilter!")},cancel:function(){this.UpdateTempJson(JSON.parse(this.cancel_json),!0)},UpdateTempJson:function(e,t){var n=this,i=e;Object(s["e"])(i).then((function(e){t&&(n.$message({type:"success",message:"取消成功!"}),n.getData())})).catch((function(e){t&&n.$message({type:"error",message:"取消失败，请稍后重试!"}),console.log(e)}))},getData:function(){var e=this;this.loading=!0;var t={field:this.currentIndicator.field,scope:this.currentIndicator.scope,F5:!0};Object(s["c"])(t).then((function(t){e.loading=!1,e.cancel_json=t[0].indicator_system,e.cancel_btn_disabled=!e.cancel_json,t=JSON.parse(t[0].indicator_system),console.log(t);var n=t[0].children;n=e.setId(n),e.tempLevel=0,e.mind={meta:{name:"",author:"",version:"0.2"},format:"node_tree",data:{id:"root",name:t[0].indicator_name,children:n,create_by:t[0].create_by,create_time:t[0].create_time,field:t[0].field,indicator_id:t[0].indicator_id,indicator_name:t[0].indicator_name,parentId:t[0].parentId,profile:t[0].profile,scope:t[0].scope,summary:t[0].summary,updateTime:t[0].updateTime,update_by:t[0].update_by,weight:t[0].weight}},e.jm.show(e.mind),e.$store.dispatch("system/changeCurrentNode",{indicator_name:t[0].indicator_name,profile:t[0].profile,summary:t[0].summary,weight:t[0].weight,create_by:t[0].create_by,create_time:t[0].create_time,update_by:t[0].update_by,updateTime:t[0].updateTime,level:t[0].level||"",indicator_unit:t[0].indicator_unit||"",indicator_sign:t[0].indicator_sign||""}),e.jm.select_node("root")}))},setId:function(e){var t=this;return this.tempLevel++,e.forEach((function(e,n){e.level=t.tempLevel,e.id=e.indicator_id?e.indicator_id:Math.random()*Math.random()*Math.random()*Math.random()*1e4,e.name=e.indicator_name,e.children&&e.children.length>0&&t.setId(e.children)})),e},get_selected_nodeid:function(){var e=this.jm.get_selected_node();return e?e.id:null},addNode:function(){var e=this.jm.get_selected_node();if(console.log(e),e){var t=100*Math.random()*Math.random()+10*Math.random(),n="子节点";this.jm.add_node(e,t,n,{noTrueId:!0,field:this.currentIndicator.field,scope:this.currentIndicator.scope}),this.jm.select_node(t),this.$store.dispatch("system/changeCurrentNode",{indicator_name:"",profile:"",summary:"",weight:"",create_by:"",create_time:"",update_by:"",updateTime:"",level:"",indicator_unit:"",indicator_sign:""})}else this.$message({type:"warning",message:"请先选择一个节点!"})},onRemoveNode:function(){var e=this.get_selected_nodeid();console.log(e),console.log(e),e?"root"!==e?this.jm.remove_node(e):this.$message({type:"warning",message:"根节点不可删除!"}):this.$message({type:"warning",message:"请先选择一个节点!"})},saveMind:function(){var e=this,t=window._jm.get_selected_node();if(t){var n=new Date;t.data.weight=this.currentNode.weight,t.data.profile=this.currentNode.profile,t.data.summary=this.currentNode.summary,t.data.indicator_name=this.currentNode.indicator_name,t.data.updateTime=Object(m["b"])(n,"{y}-{m}-{d} {h}:{i}"),t.data.update_by="admin";var i=t.id;window._jm.update_node(i,this.currentNode.indicator_name)}var a=[this.jm.get_data().data];if(console.log(a),console.log(this.validMind(a)),this.validMind(a)){var r={field:a[0].field,scope:a[0].scope,submit:!0};Object(s["e"])(a,!1),Object(s["d"])(r).then((function(t){console.log(t),"保存成功"===t&&(e.$message({type:"success",message:"确认更改成功"}),e.$router.push("/indicator/list/"))}))}},validMind:function(e){var t=this,n=!0;return e.forEach((function(e,i){if(!(e.children&&e.children.length>0))throw n=!1,t.$message({type:"error",message:"“"+e.name+"” 下缺少1级指标无法确认更改!"}),new Error("缺少1级指标");e.children.forEach((function(e,i){if(!(e.children&&e.children.length>0))throw n=!1,t.$message({type:"error",message:"“"+e.name+"” 下缺少2级指标无法确认更改!"}),new Error("缺少2级指标");e.children.forEach((function(e,i){if(!(e.children&&e.children.length>0))throw n=!1,t.$message({type:"error",message:"“"+e.name+"” 下缺少3级指标无法确认更改!"}),new Error("缺少3级指标");e.children.forEach((function(e,i){if(e.children&&e.children.length>0)throw n=!1,t.$message({type:"error",message:"“"+e.name+"” 下存在4级指标无法确认更改!"}),new Error("存在4级指标")}))}))}))})),n},validateMindJson:function(e){var t=this;return e.forEach((function(e,n){e.id=e.indicator_id,e.name=e.indicator_name,e.children&&e.children.length>0&&t.setId(e.children)})),e},selectNodeChange:function(e,t){var n=window._jm.get_selected_node();console.log(n),console.log(n.data.level),this.$store.dispatch("system/changeCurrentNode",{indicator_name:n.data.indicator_name,profile:n.data.profile,summary:n.data.summary,weight:n.data.weight,create_by:n.data.create_by,create_time:n.data.create_time,update_by:n.data.update_by,updateTime:n.data.updateTime,level:n.data.level||"",indicator_unit:n.data.indicator_unit||"",indicator_sign:n.data.indicator_sign||""})},saveTempMind:function(){console.log("存入临时表")}}},v=f,b=Object(h["a"])(v,i,a,!1,null,null,null);t["default"]=b.exports}}]);